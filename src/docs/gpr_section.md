# Раздел "ГПР" (График Производства Работ)

## Описание

Раздел "ГПР" предназначен для заполнения исполнительным директором и начальником участка. Он позволяет отслеживать планируемые и фактические объемы работ по различным типам материалов на разных объектах с детализацией по дням.

## Структура таблицы

### Основная таблица

1. **Заказчик** - поле с выпадающим списком, данные подтягиваются из раздела создания проектов
2. **Объект** - поле с выпадающим списком, данные выбираются из созданных объектов
3. **Вид работ** - тип материала исполнения:
   - ТП (Термопластик)
   - ТПж (Термопластик жёлтый)
   - ХП (Холодный пластик)
   - ХПж (Холодный пластик жёлтый)
   - Краска ж (Жёлтая краска)
   - Краска б (Белая краска)
   - Краска ч (Чёрная краска)
4. **V³ м2 ПЛАН** - объем планируемых работ по каждому типу материала
5. **V³ м2 ФАКТ** - объем фактически выполненных работ по каждому типу материала
6. **V³ остаток** - оставшийся объем работ по каждому материалу
7. **Выполнение** - визуальная шкала в процентах, показывающая статус выполнения
8. **Ежедневные данные** - 30/31 столбец (в зависимости от месяца) с датами, в которых вводится объем выполнения по каждому дню

### Сводная таблица

Ниже основной таблицы находится сводная таблица с материалами:

- Краска б
- Краска ч
- Времянка
- Краска ж
- ХП
- ХПж
- ТП
- Демаркировка

Для каждого материала указывается:

- **План** - сумма объемов из пункта 4 по объектам, работы по которым будут выполняться в течение следующей недели
- **Факт** - сумма объемов из пункта 5, вычисляется на основе заполненных данных

Дата начала недели выбирается исключительно исполнительным директором для формирования недельного отчета.

## Техническая реализация

### Frontend

- Компонент `GPRTable.tsx` реализует основную таблицу с использованием Material-UI DataGrid
- Реализована возможность редактирования ячеек
- Динамическая генерация колонок для ежедневных данных
- Визуализация прогресса выполнения с помощью LinearProgress
- Формирование сводной таблицы на основе данных из основной таблицы

### Backend

- Модель `GPRRecord` для хранения записей ГПР
- Маршруты API для CRUD операций с записями ГПР
- Модель `WeeklyReport` для хранения недельных отчетов
- Маршрут для генерации недельного отчета
- Поддержка JSON для хранения ежедневных данных

### Типы данных

- Определены TypeScript интерфейсы в `shared/types/gpr.ts`
- Включают все необходимые типы для работы с данными ГПР
- Обеспечивают согласованность между фронтендом и бэкендом

## API endpoints

- `GET /api/gpr/records` - получить список записей ГПР
- `POST /api/gpr/records` - создать новую запись ГПР
- `PUT /api/gpr/records/{record_id}` - обновить запись ГПР
- `DELETE /api/gpr/records/{record_id}` - удалить запись ГПР
- `POST /api/gpr/weekly-report` - сгенерировать недельный отчет
- `GET /api/gpr/weekly-report/{week_start_date}` - получить недельный отчет

## Особенности реализации

1. Автоматический пересчет остатка и прогресса при изменении плана или факта
2. Поддержка динамических колонок для ежедневных данных
3. Возможность выбора недели для формирования отчета
4. Валидация формата даты
5. Интеграция с существующими справочниками заказчиков и объектов