# Система замечаний от строительного контроля

## Общее описание

Система замечаний от строительного контроля — это модуль Строд-Сервис Технолоджи, предназначенный для отслеживания и управления замечаниями, выявленными в ходе строительного контроля. Система позволяет:

- Фиксировать замечания по мере их поступления
- Выбирать объект строительства, к которому относится замечание
- Присваивать уникальный номер каждому замечанию
- Отслеживать статус замечания на протяжении всего цикла обработки
- Прикреплять фотоотчеты к каждому замечанию
- Вести историю изменений статусов замечаний

## Архитектура системы

### Модели данных

#### 1. ConstructionRemark (Замечание)
- `id`: Уникальный идентификатор замечания
- `remark_number`: Уникальный номер замечания
- `project_object_id`: Ссылка на объект проекта, к которому относится замечание
- `title`: Заголовок замечания
- `description`: Описание замечания
- `status`: Статус замечания (NEW, IN_PROGRESS, FIXED, VERIFIED, CLOSED, REJECTED)
- `priority`: Приоритет (low, normal, high, critical)
- `assigned_to`: Кому назначено замечание
- `deadline`: Срок исправления
- `created_by`: Кто создал замечание
- `created_at`: Дата создания
- `updated_at`: Дата последнего обновления

#### 2. RemarkPhoto (Фотография к замечанию)
- `id`: Уникальный идентификатор
- `remark_id`: Ссылка на замечание
- `file_path`: Путь к файлу на сервере
- `filename`: Имя файла
- `file_size`: Размер файла в байтах
- `description`: Описание фотографии
- `created_by`: Кто загрузил фотографию
- `created_at`: Дата загрузки

#### 3. RemarkHistory (История изменений)
- `id`: Уникальный идентификатор
- `remark_id`: Ссылка на замечание
- `old_status`: Предыдущий статус
- `new_status`: Новый статус
- `comment`: Комментарий к изменению
- `changed_by`: Кто изменил статус
- `changed_at`: Дата изменения

### Статусы замечаний

- `NEW` (новое): Замечание только что создано и зарегистрировано
- `IN_PROGRESS` (в работе): Замечание находится в процессе исправления
- `FIXED` (исправлено): Замечание исправлено, ожидает проверки
- `VERIFIED` (проверено): Замечание проверено и подтверждено исправление
- `CLOSED` (закрыто): Замечание полностью закрыто
- `REJECTED` (отклонено): Замечание отклонено как необоснованное

## API эндпоинты

### Замечания

- `POST /construction-remarks/` - создание нового замечания
- `GET /construction-remarks/{remark_id}` - получение замечания с деталями (фото, история)
- `PUT /construction-remarks/{remark_id}` - обновление замечания
- `DELETE /construction-remarks/{remark_id}` - удаление замечания
- `GET /construction-remarks/` - получение списка замечаний с фильтрами
- `GET /construction-remarks/search` - поиск замечаний
- `GET /construction-remarks/project-object/{project_object_id}` - получение всех замечаний для объекта
- `GET /construction-remarks/status/{status}` - получение замечаний по статусу
- `GET /construction-remarks/overdue` - получение просроченных замечаний
- `GET /construction-remarks/project-object/{project_object_id}/summary` - сводка по замечаниям для объекта

### Фотографии

- `POST /construction-remarks/{remark_id}/photos` - загрузка фотографии к замечанию
- `GET /construction-remarks/{remark_id}/photos` - получение всех фотографий для замечания
- `PUT /construction-remarks/photos/{photo_id}` - обновление описания фотографии
- `DELETE /construction-remarks/photos/{photo_id}` - удаление фотографии

### История изменений

- `GET /construction-remarks/{remark_id}/history` - получение истории изменений статуса замечания

## Возможности системы

### 1. Регистрация замечаний
- Автоматическая генерация уникальных номеров
- Привязка к объекту строительства
- Указание приоритета и срока исправления

### 2. Отслеживание статуса
- Полный жизненный цикл замечания
- История всех изменений статуса
- Возможность отслеживания прогресса

### 3. Фотофиксация
- Загрузка фотографий к каждому замечанию
- Хранение фотоотчетов
- Описание фотографий

### 4. Поиск и фильтрация
- Поиск по номеру, заголовку, описанию
- Фильтрация по объекту, статусу, приоритету
- Отображение просроченных замечаний

### 5. Статистика и отчеты
- Сводка по замечаниям для каждого объекта
- Распределение по статусам
- История изменений

## Использование в проекте

Система интегрирована в основной API Строд-Сервис Технолоджи и доступна через эндпоинт `/construction-remarks`. Для работы с системой требуется аутентификация и соответствующие права доступа.

## Технические особенности

- Реализована на FastAPI с использованием SQLAlchemy ORM
- Поддержка асинхронных операций
- Полностью типизированный код с использованием Pydantic
- Интеграция с существующей системой аутентификации
- Автоматическое логирование изменений
- Поддержка файловых вложений (фотографии)

## Безопасность

- Доступ к данным только авторизованными пользователями
- Разграничение прав доступа (администраторы могут удалять замечания)
- Логирование всех действий пользователей